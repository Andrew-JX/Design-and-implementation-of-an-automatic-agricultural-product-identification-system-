<!doctype html>
<html>
<head>
    <title>用户个人信息修改</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
    <meta content="yes" name="apple-mobile-web-app-capable" />
    <meta content="black" name="apple-mobile-web-app-status-bar-style" />
    <meta content="telephone=no" name="format-detection" /><meta name="full-screen" content="true" />
    <meta name="screen-orientation" content="portrait" />
    <meta name="x5-fullscreen" content="true" />
    <meta name="360-fullscreen" content="true" />
    <meta HTTP-EQUIV="pragma" content="no-cache" />
    <meta HTTP-EQUIV="Cache-Control" content="no-store, must-revalidate" />
    <meta HTTP-EQUIV="expires" content="Wed, 26 Feb 1997 08:21:57 GMT" />
    <meta HTTP-EQUIV="expires" content="0" />
    <link href=/static/vue/css/vuecss.css rel=stylesheet>
    <script src="/static/vue/js/vue.js"></script>
    <script src="/static/element-ui/index.js"></script>
    <link rel="stylesheet" type="text/css" href="/static/animate/animate.css">
    <link rel="stylesheet" type="text/css" href="/static/bootstrap/css/bootstrap.min.css">
    <script src="/static/jquery/jquery-1.8.3.min.js"></script>
    <script src="/static/bootstrap/js/bootstrap.min.js"></script>
    <script src="/static/sel/js/codejs.js"></script>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <script src="./function.js"></script>
      <link rel="stylesheet" type="text/css" href="../css.css">

</head>
<body>
<div id="app">


    <div class="container">
        <div class="row clearfix">
            <div class="col-md-12 column">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">
                            用户个人信息修改
                        </h3>
                    </div>
                    <div class="panel-body">



                            <el-form  ref="edit_form" :rules="edit_rules" :model="edit_form" label-width="100px" >
                                <el-form-item label="姓名" prop="cname">
<el-input v-model="edit_form.cname"></el-input> 
  </el-form-item>

<el-form-item label="性别" prop="sex">
  <el-select v-model="edit_form.sex" placeholder="请选择">
 <el-option   v-for="item in sex_options"
:key="item.value"
  :label="item.label"
:value="item.value">
  </el-select>
  </el-form-item>

<el-form-item label="手机" prop="tel">
<el-input v-model="edit_form.tel"></el-input> 
  </el-form-item>

<el-form-item label="邮箱" prop="email">
<el-input v-model="edit_form.email"></el-input> 
  </el-form-item>



                                <el-form-item>
                                    <el-button type="primary"    @click="goEdit('edit_form')">提交</el-button>
                                    &nbsp;&nbsp;
                                    <el-button type="info"    @click="goblack()">返回</el-button>
                                </el-form-item>
                            </el-form>
                            <br/>	 <br/>


                    </div>
                    <div class="panel-footer"  >



                    </div>
                </div>
            </div>
        </div>
    </div>


</div>


<script>
    var ubiao="userlist";

    var data={
        edit_form:
        {
            id: '',  //编号  
username: '',  //用户名  
password: '',  //密码  
cname: '',  //姓名  
sex: '',  //性别  
tel: '',  //手机  
email: '',  //邮箱  



        },
        id:0,

        edit_rules: {
            username:[
{ required: true, message: '请输入用户名', trigger: 'blur' },
 ],

password:[
{ required: true, message: '请输入密码', trigger: 'blur' },
 ],

cname:[
{ required: true, message: '请输入姓名', trigger: 'blur' },
 ],

sex:[
{ required: true, message: '请输入性别', trigger: 'blur' },
 ],

tel:[
{ required: true, message: '请输入手机', trigger: 'blur' },
{ min: 11, max: 11, message: '请输入11位的手机号', trigger: 'blur' },
 { pattern:/^(1[35784]\d{9})$/, message: "请输入合法手机号", trigger: "blur" },
 ],

email:[
{ required: true, message: '请输入邮箱', trigger: 'blur' },
  { pattern:/^([0-9A-Za-z\-_\.]+)@([0-9a-z]+\.[a-z]{2,3}(\.[a-z]{2})?)$/g, message: "请输入正确的邮箱", trigger: "blur"},
 ],



        },

          

  

  

sex_options:[

{value:'男',label:'男'},

{value:'女',label:'女'},
],
  

  

  



    }

    //得到详细信息---------------------------------------------------------


    //信息---------------------------------------------------------
    var   getInfo=function()
    {
        //先把本地对象缓存下来
        var self = this;
        //-----------------------------

        var url="/"+ubiao+"/"+ubiao[0].toUpperCase()+ubiao.substr(1)+"GetLogin";//apiurl
        $.ajax({
            url: url,
            data: null,
            type: "POST",
            dataType: "json",
            success: function(json) {
                if(json.msg=="666666")
                {
                    self.edit_form=json.enlist;
                      
  
  
  
  
  
  

                }
                else
                {
                    top.location="login.html";
                }
            }
        });
        //-----------------------------
    }



    //---------得到详细信息 end--------------------------------------------------------------------------------

    //------------修改提交------------------------------------------------------------------------------------
    var  goEdit=function(formName)
    {
        var self = this;
        this.$refs[formName].validate((valid) =>
        {
            if (valid) {

                // var wcode=encodeURIComponent(self.modeexcode_form.memo);
                var body="1";
                for(var key in this.edit_form){
                    body = body + "&" + key + "=" + zma(this.edit_form[key]);
                }
                var url="/"+ubiao+"/update"+ubiao[0].toUpperCase()+ubiao.substr(1)+"Submit";  //apiurl
                fetch(url, {
                    method: "POST",
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: body
                    ,
                }) .then(function(response) {
                    return response.json()
                }).then(function(json) {
                    if(json.msg=="666666")
                    {
                        self.$message({
                            type: 'success',
                            message: '成功!',
                        });
                        setTimeout(function(){location="info.html";},2000);
                    }
                    else
                    {
                        self.$message({
                            type: 'warning',
                            message: '错误!',
                        });

                    }

                }).catch(function(ex) {  console.log('error submit!!');   })
                //-----------------------------

            }
            else
            {
                //   console.log('error submit!!');
                return false;
    }
    });

    }





        //--------- edit end----------



              
  
  
  
  
  
  








    var goblack=function()
    {
        window.history.back();
    }

    //跳转添加
    var upadd=function()
    {
        location="add.html";

    }

    var vm = new Vue({
        el: "#app",
        data:data,
        methods:
        {

            getInfo:getInfo,
            goEdit:goEdit,
            goblack:goblack,
            upadd:upadd,
              
  
  
  
  
  
  



                    

        },
        created: function ()
        {
            this.getInfo();
        }

    });


</script>



</body>
</html>



